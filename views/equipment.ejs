<!doctype html>
<html lang="th">
<head>
    <title><%= typeof title !== 'undefined' ? title : 'สต็อกอุปกรณ์กีฬา' %></title>
    <%- include('partials/head') %>
    <style>
        /* ========================================================================= */
        /* =========================== STYLES: GLOBAL/VARS ========================= */
        /* ========================================================================= */
        :root{
            --brand: #1f8a4c; /* Green Brand Color */
            --bg: #f5f7fa; /* Light Background */
            --card: #ffffff;
            --ink: #1e293b;
            --muted: #6b7280;
            --line: #e4e7eb;
            --shadow-md: 0 6px 20px rgba(0, 0, 0, 0.08);
            --border-radius: 12px;
        }
        body{font-family:'Prompt',sans-serif;background:var(--bg);color:var(--ink)}
        .wrap{max-width:1000px;margin:40px auto;padding:0 15px}

        /* Card Style */
        .cardx{
            background:var(--card);
            border:1px solid #d1d5db;
            border-radius:var(--border-radius);
            box-shadow:var(--shadow-md);
            padding:30px;
        }
        .page-title{
            font-weight:800;
            margin-bottom:8px;
            text-align:center;
            color:var(--brand);
            font-size: 1.8rem;
        }
        .subtext{
            color:var(--muted);
            text-align:center;
            margin-bottom:30px;
            font-size:.95rem;
        }

        /* ========================================================================= */
        /* =========================== STYLES: TABLE =============================== */
        /* ========================================================================= */
        .table{
            margin-bottom: 0;
            border-collapse: separate;
            border-spacing: 0;
            overflow: hidden;
            border: 1px solid #d1d5db; /* Add border to table itself */
            border-radius: 8px; /* Rounded table corners */
        }
        .table thead th{
            background: #4a5568; /* Darker header for contrast */
            color:#fff;
            text-align:center;
            vertical-align:middle;
            border:none;
            padding: 12px 10px;
            font-weight: 600;
        }
        /* Top corners for the table header */
        .table thead tr th:first-child { border-top-left-radius: 8px; }
        .table thead tr th:last-child { border-top-right-radius: 8px; }

        .table td{
            vertical-align:middle;
            text-align:center;
            padding: 12px 10px;
        }
        .table-striped tbody tr:nth-of-type(odd){
            background-color: #f9fafb;
        }
        .table-hover tbody tr:hover{background:#edf2f7; cursor: default;}
        .table-bordered td, .table-bordered th{border-color:var(--line)}
        
        /* Status Badges */
        .status-available, .status-unavailable{
            padding: 5px 12px;
            border-radius: 25px;
            font-size: .8rem;
            font-weight: 700;
            display: inline-block;
        }
        .status-available{
            color:#166a39;
            background-color: #ecfdf5;
            border: 1px solid #a7f3d0;
        }
        .status-unavailable{
            color:#b91c1c;
            background-color: #fef2f2;
            border: 1px solid #fca5a5;
        }

        /* Footer and Button */
        tfoot td {
            font-size: .85rem;
            color: var(--muted);
            background-color: #f7f9fc;
            border-top: 1px solid var(--line);
        }
        .back-btn{
            margin-top:30px; /* เพิ่มระยะห่าง */
            padding: 10px 30px;
            border-radius: 8px;
            font-weight: 600;
            background-color: #6c757d;
            border-color: #6c757d;
        }
        .btn-secondary:hover {
            background-color: #5a6268;
            border-color: #545b62;
        }
    </style>
</head>
<body>
<div class="wrap">
    <div class="cardx">

        <h2 class="page-title"><i class="bi bi-list-ul me-2"></i>สต็อกอุปกรณ์กีฬา</h2>
        <div class="subtext">มุมมองสำหรับนักศึกษา (แสดงรายการและสถานะอุปกรณ์คงเหลือที่พร้อมให้ยืม)</div>

        <div class="table-responsive">
            <table class="table table-striped table-hover align-middle">
                <thead>
                    <tr>
                        <th style="width:70px">ลำดับ</th>
                        <th class="text-start">ชื่ออุปกรณ์</th>
                        <th style="width:140px">สต็อกทั้งหมด</th>
                        <th style="width:140px">กำลังถูกยืม</th>
                        <th style="width:140px">คงเหลือ</th>
                        <th style="width:140px">สถานะ</th>
                    </tr>
                </thead>
                <tbody>
                    <% if (Array.isArray(inventory) && inventory.length > 0) { %>
                        <% inventory.forEach((item, index) => { 
                            const physical = Number(item.physical_stock ?? item.stock ?? 0);
                            const usingNow = Number(item.outstanding_in_use ?? 0);
                            const available = Number(item.available_for_new_borrow ?? (physical - usingNow)); 
                            const isActive = !!item.active;
                            const canBorrow = isActive && available > 0;
                        %>
                            <tr>
                                <td><%= index + 1 %></td>
                                <td class="text-start fw-semibold"><%= item.item_name %></td>
                                <td><%= physical %></td>
                                <td><%= usingNow %></td>
                                <td class="fw-bold fs-6 <%= available > 0 ? 'text-success' : 'text-danger' %>"><%= available %></td>
                                <td>
                                    <% if (canBorrow) { %>
                                        <span class="status-available">พร้อมยืม</span>
                                    <% } else { %>
                                        <span class="status-unavailable">ไม่พร้อมยืม</span>
                                    <% } %>
                                </td>
                            </tr>
                        <% }) %>
                    <% } else { %>
                        <tr>
                            <td colspan="6" class="text-center text-muted p-4">
                                <i class="bi bi-info-circle me-1"></i> ไม่มีข้อมูลอุปกรณ์ในสต็อก ณ ขณะนี้
                            </td>
                        </tr>
                    <% } %>
                </tbody>

                <% if (Array.isArray(inventory) && inventory.length > 0) { %>
                    <tfoot>
                        <tr>
                            <td colspan="6" class="text-end">
                                รวมรายการ: <b><%= inventory.length %></b> รายการ
                            </td>
                        </tr>
                    </tfoot>
                <% } %>
            </table>
        </div>

        <div class="text-center">
            <a href="/" class="btn btn-secondary back-btn"><i class="bi bi-arrow-left me-2"></i>กลับหน้าหลัก</a>
        </div>

    </div>
</div>
    <%- include('partials/footer') %>
</body>
</html>