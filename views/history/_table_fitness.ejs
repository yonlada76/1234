<%- include('../partials/head') %>
<style>
    /* =========================== STYLES: TABLE & BADGE ========================= */
    :root {
        --brand: #1f8a4c;
        --line: #e4e7eb;
        --ink: #1e293b;
    }
    .table {
        background: white;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 4px 12px rgba(0,0,0,.05);
        border: 1px solid #d1d5db;
        font-size: 0.95rem;
    }
    .table thead th {
        background: #f1f5f9; /* Soft header */
        color: #475569;
        font-weight: 600;
        border-color: #d1d5db;
        padding: 12px 10px;
    }
    .table tbody tr:hover { background-color: #f7f9fc; }
    .table td { border-color: #f8fafc; vertical-align: middle; }

    /* Badge Styles */
    .badge-student { 
        background-color: var(--brand) !important;
        border: 1px solid var(--brand);
        color: white;
        font-weight: 600;
        padding: .4rem .9rem;
        border-radius: 999px;
        font-size: 0.8rem;
    }
    .badge-external { 
        background-color: #fca5a5 !important; 
        color: #b91c1c;
        border: 1px solid #f87171;
        font-weight: 600;
        padding: .4rem .9rem;
        border-radius: 999px;
        font-size: 0.8rem;
    }
    
    .text-amount {
        font-weight: 700;
        color: #16a34a; /* Green for money received */
        font-size: 1rem;
    }
    .mono-code {
        font-family: ui-monospace, monospace;
        color: #475569;
        font-size: 0.9rem;
    }
</style>

<% const rows = Array.isArray(locals.rows) ? locals.rows : []; %>

<h3 class="mb-3"><i class="bi bi-clock-history me-2"></i>ประวัติการเข้าใช้ฟิตเนส</h3>

<div class="table-responsive">
    <table class="table table-striped table-hover align-middle">
        <thead>
            <tr>
                <% if (showMemberCols) { %>
                    <th style="min-width:180px">สมาชิก</th>
                    <th style="min-width:100px">ประเภท</th>
                    <th style="min-width:160px">รหัส (Student/Citizen ID)</th>
                <% } %>
                <th style="min-width:120px">วันที่เข้าใช้</th>
                <th class="text-center" style="min-width:100px">ค่าบริการ (฿)</th>
                <th style="min-width:100px">วิธีชำระ</th>
            </tr>
        </thead>
        <tbody>
        <% if (!rows.length) { %>
            <tr><td colspan="<%= showMemberCols ? 6 : 3 %>" class="text-center text-muted p-4">
                <i class="bi bi-info-circle me-1"></i> ไม่มีข้อมูลการเข้าใช้ฟิตเนส
            </td></tr>
        <% } %>
        <% rows.forEach(r => { %>
            <tr>
                <% if (showMemberCols) { %>
                    <td><b><%= r.full_name || '-' %></b></td>
                    <td>
                        <% if (r.member_type === 'student') { %>
                            <span class="badge-student">นักศึกษา</span>
                        <% } else { %>
                            <span class="badge-external">ภายนอก</span>
                        <% } %>
                    </td>
                    <td class="mono-code">
                        <%= r.member_type==='student' ? (r.student_id||'-') : (r.citizen_id||'-') %>
                    </td>
                <% } %>
                <td><%= r.visit_date ? new Date(r.visit_date).toLocaleDateString('th-TH') : '-' %></td>
                <td class="text-center text-amount"><%= r.amount %></td>
                <td>
                    <%= r.pay_method === 'qr' ? 'สแกน QR / โอน' : 'เงินสด' %>
                </td>
            </tr>
        <% }) %>
        </tbody>
        <% if (rows.length) { %>
            <tfoot>
                <tr>
                    <td colspan="<%= showMemberCols ? 6 : 3 %>" class="text-end text-muted small pt-3">
                        รวมรายการ: <b><%= rows.length %></b> ครั้ง
                    </td>
                </tr>
            </tfoot>
        <% } %>
    </table>
</div>
<%- include('../partials/footer') %>